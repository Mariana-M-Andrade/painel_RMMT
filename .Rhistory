# Agrupando por ano e uf, e somando os obitos
all_obitos <- all_obitos %>%
group_by(ano, uf, regiao, idade, racacor, categoria) %>%
summarise(obitos = sum(obitos, na.rm = TRUE), .groups = 'drop')
#Juntando as bases de Óbitos e nascidos vivos
obit_nasc <- full_join(all_obitos, sinasc, by = c("ano","uf"))
#Selecionando as variáveis necessárias para o calcula da RMM
obit_nasc <- obit_nasc %>%
select(uf, ano, nascidos, obitos) %>%
filter(!is.na(uf))
#Calculando a RMM tardia
obit_nasc <- obit_nasc %>%
mutate(
obitos = as.numeric(gsub("\\.", "", obitos)),
nascidos = as.numeric(gsub("\\.", "", nascidos))
) %>%
group_by(ano, uf) %>%
summarise(
obitos = sum(obitos, na.rm = TRUE),
nascidos = sum(nascidos, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(rmm = round((obitos / nascidos) * 100000, 2))
#Juntando as bases de Óbitos e nascidos vivos
obit_nasc <- full_join(all_obitos, sinasc, by = c("ano","uf"))
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade") %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Nasciso vivos
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade") %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Nasciso vivos
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_ofc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc <- read_delim("sinasc.csv", delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc_br <- read_delim("sinasc.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
tabela_aux_municipios <- read_delim("tabela_auxiliar_municipios.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE)
estadosChoices <- sort(unique(tabela_aux_municipios$uf))
# Definindo as configurações globais das tabelas
options(reactable.theme = reactableTheme(
borderColor = "#dfe2e5",
stripedColor = "#e5efff",
highlightColor = "#CDDEFC",
cellPadding = "8px 12px",
searchInputStyle = list(width = "100%")
))
# Obtendo o dia, mês e ano por extenso
df_meses <- data.frame(
num_mes = 1:12,
nome_mes = c("janeiro", "fevereiro", "março", "abril", "maio", "junho", "julho","agosto", "setembro", "outubro", "novembro", "dezembro")
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade") %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Nasciso vivos
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_ofc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc <- read_delim("sinasc.csv", delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc_br <- read_delim("sinasc.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
tabela_aux_municipios <- read_delim("tabela_auxiliar_municipios.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE)
estadosChoices <- sort(unique(tabela_aux_municipios$uf))
# Definindo as configurações globais das tabelas
options(reactable.theme = reactableTheme(
borderColor = "#dfe2e5",
stripedColor = "#e5efff",
highlightColor = "#CDDEFC",
cellPadding = "8px 12px",
searchInputStyle = list(width = "100%")
))
# Obtendo o dia, mês e ano por extenso
df_meses <- data.frame(
num_mes = 1:12,
nome_mes = c("janeiro", "fevereiro", "março", "abril", "maio", "junho", "julho","agosto", "setembro", "outubro", "novembro", "dezembro")
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015, ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade") %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_ofc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade") %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
View(df_mt_desc)
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano")
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
df_mt_desc <- df_mt_desc %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
df_mt_desc <- df_mt_desc %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))%>%
filter(idade >= 10 & idade <= 49)
df_mt_desc <- df_mt_desc %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))%>%
filter(idade >= 10 & idade <= 49)%>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")
df_mt_desc <- df_mt_desc %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))%>%
filter(idade >= 10 & idade <= 49)%>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(ano >= 2015 & ano<= 2022)
df_mt_desc <- df_mt_desc %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))%>%
filter(idade >= 10 & idade <= 49)%>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(ano >= 2015 & ano<= 2022)%>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano")
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Nasciso vivos
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
View(sinasc_br)
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_ofc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc <- read_delim("sinasc.csv", delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc_br <- read_delim("sinasc.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
tabela_aux_municipios <- read_delim("tabela_auxiliar_municipios.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE)
estadosChoices <- sort(unique(tabela_aux_municipios$uf))
# Definindo as configurações globais das tabelas
options(reactable.theme = reactableTheme(
borderColor = "#dfe2e5",
stripedColor = "#e5efff",
highlightColor = "#CDDEFC",
cellPadding = "8px 12px",
searchInputStyle = list(width = "100%")
))
# Obtendo o dia, mês e ano por extenso
df_meses <- data.frame(
num_mes = 1:12,
nome_mes = c("janeiro", "fevereiro", "março", "abril", "maio", "junho", "julho","agosto", "setembro", "outubro", "novembro", "dezembro")
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério,de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(periodo_do_obito == "Durante o puerpério,de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Nasciso vivos
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_ofc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Nasciso vivos
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
library(flexdashboard)
library(tidyverse)
library(janitor)
library(shiny)
library(reactable)
library(reactablefmtr)
library(openxlsx)
library(gtsummary)
library(gt)
library(glue)
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_ofc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc <- read_delim("sinasc.csv", delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc_br <- read_delim("sinasc.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
tabela_aux_municipios <- read_delim("tabela_auxiliar_municipios.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE)
estadosChoices <- sort(unique(tabela_aux_municipios$uf))
# Definindo as configurações globais das tabelas
options(reactable.theme = reactableTheme(
borderColor = "#dfe2e5",
stripedColor = "#e5efff",
highlightColor = "#CDDEFC",
cellPadding = "8px 12px",
searchInputStyle = list(width = "100%")
))
# Obtendo o dia, mês e ano por extenso
df_meses <- data.frame(
num_mes = 1:12,
nome_mes = c("janeiro", "fevereiro", "março", "abril", "maio", "junho", "julho","agosto", "setembro", "outubro", "novembro", "dezembro")
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#MMT
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
# Carregando os arquivos necessários
df_mt_desc <- read_delim("obitos_desc_2.0.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
View(df_mt_desc)
#MMT
df_mt_desc <- df_mt_desc %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
all_obitos <- all_obitos %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano") %>%
#Mudando o tipo da variável
all_obitos$ano <- as.character(all_obitos$ano)
all_obitos <- all_obitos %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano")
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
all_obitos <- all_obitos %>%
filter(periodo_do_obito = "Durante o puerpério, de 43 dias a menos de 1 ano")
all_obitos <- all_obitos %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano")
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
all_obitos <- all_obitos %>%
filter(periodo_do_obito == Durante o puerpério, de 43 dias a menos de 1 ano)
all_obitos <- all_obitos %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano")
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
df_mt_desc <- df_mt_desc %>%
filter(periodo_do_obito == "Durante o puerpério, de 43 dias a menos de 1 ano")
shiny::runApp('omt_rmmt')
load("~/UFES/OOBr/Morte Materna Tardia/MMT/Painel OOBr/painel-obitos-grav-puerp-main/ENV.RData")
library(flexdashboard)
library(tidyverse)
library(janitor)
library(shiny)
library(reactable)
library(reactablefmtr)
library(openxlsx)
library(gtsummary)
library(gt)
library(glue)
# Carregando os arquivos necessÃ¡rios
df_mt_desc <- read_delim("df_mt_desc_tardia.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
obitos_mt_ofc <- read_delim("obitos_mt_ofc_tardia.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
sinasc <- read_csv("sinasc.csv")
sinasc_br <- read_delim("sinasc.csv",delim = ",", escape_double = FALSE, trim_ws = TRUE) |>
clean_names()
tabela_aux_municipios <- read_delim("tabela_auxiliar_municipios.csv",
delim = ",", escape_double = FALSE, trim_ws = TRUE)
estadosChoices <- sort(unique(tabela_aux_municipios$uf))
# Definindo as configuraÃ§Ãµes globais das tabelas
options(reactable.theme = reactableTheme(
borderColor = "#dfe2e5",
stripedColor = "#e5efff",
highlightColor = "#CDDEFC",
cellPadding = "8px 12px",
searchInputStyle = list(width = "100%")
))
# Obtendo o dia, mÃªs e ano por extenso
df_meses <- data.frame(
num_mes = 1:12,
nome_mes = c("janeiro", "fevereiro", "marÃ§o", "abril", "maio", "junho", "julho",
"agosto", "setembro", "outubro", "novembro", "dezembro")
)
data <- Sys.Date()
data_por_extenso <- glue(
"{substr(data, 9, 10)} de {df_meses$nome_mes[which(df_meses$num_mes == as.numeric(substr(data, start = 6, stop = 7)))]} de {substr(data, 1, 4)}"
)
# Agrupando por ano e uf, e somando os obitos
all_obitos <- all_obitos %>%
group_by(ano, uf, regiao, idade, racacor, categoria) %>%
summarise(obitos = sum(obitos, na.rm = TRUE), .groups = 'drop')
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
#Mudando o tipo da variável
all_obitos$ano <- as.character(all_obitos$ano)
sinasc$ano <- as.character(sinasc$ano)
# Agrupando por ano e uf, e somando os obitos
all_obitos <- all_obitos %>%
group_by(ano, uf, regiao, idade, racacor, categoria) %>%
summarise(obitos = sum(obitos, na.rm = TRUE), .groups = 'drop')
#MMT
df_mt_desc <- df_mt_desc %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(capitulo_cid10 != "XX - Causas externas de morbidade e de mortalidade")%>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Óbitos oficiais
obitos_mt_ofc <- obitos_mt_ofc %>%
filter(ano >= 2015 & ano<= 2022) %>%
filter(idade >= 10 & idade <= 49) %>%
mutate(categoria = str_sub(causabas_categoria, end = 3))
#Selecionando as variáveis necessárias
sinasc <- sinasc %>%
select(uf, ano, nascidos)
#Filtrando a base Sinasc
sinasc_br <- sinasc_br %>%
filter(localidade_nome == "Brasil") %>%
select(ano, localidade_nome, nascidos)
#Mudando o tipo da variável
sinasc_br$ano <- as.character(sinasc_br$ano)
#Juntando as bases de Óbitos desconsiderados e Óbitos oficiais
all_obitos <- bind_rows(df_mt_desc, obitos_mt_ofc)
#Mudando o tipo da variável
all_obitos$ano <- as.character(all_obitos$ano)
sinasc$ano <- as.character(sinasc$ano)
# Agrupando por ano e uf, e somando os obitos
all_obitos <- all_obitos %>%
group_by(ano, uf, regiao, idade, racacor, categoria) %>%
summarise(obitos = sum(obitos, na.rm = TRUE), .groups = 'drop')
#Juntando as bases de Óbitos e nascidos vivos
obit_nasc <- left_join(all_obitos, sinasc, by = c("ano", "uf"))
#Tirando NA da base
obit_nasc <- obit_nasc %>%
filter(!is.na(uf))
# Renderizando o mapa
output$mapaRMMT <- renderPlot({
# Validando se os dados estão disponíveis
validate(
need(nrow(dados_rmmt_filtrados()) > 0, "Não existem registros suficientes para gerar o mapa.")
)
#Calculando a RMM tardia
dados_rmmt_filtrados <- dados_rmmt_filtrados %>%
mutate(
obitos = as.numeric(gsub("\\.", "", obitos)),
nascidos = as.numeric(gsub("\\.", "", nascidos))
) %>%
group_by(uf) %>%
summarise(
obitos = sum(obitos, na.rm = TRUE),
nascidos = sum(nascidos, na.rm = TRUE),
.groups = 'drop'
) %>%
mutate(rmm = round((obitos / nascidos) * 100000, 2))
# Filtrando os dados para o mapa
data1 <- dados_rmmt_filtrados() %>%
group_by(uf) %>%
summarise(rmm = mean(rmm, na.rm = TRUE))
# Carregando os limites das UFs com o pacote geobr
br_uf <- read_state(year = 2020, simplified = TRUE)
# Juntando os dados de RMM com os dados geográficos das UFs
br_uf1 <- left_join(br_uf, data1, by = c("abbrev_state" = "uf"))
# Verificando se os dados para as UFs estão disponíveis
if (nrow(br_uf1) == 0) {
return(NULL)  # Caso não existam dados, o mapa não será renderizado
}
# Plotando o mapa
ggplot(data = br_uf1) +
geom_sf(aes(fill = rmm), color = "white") +
scale_fill_gradient(low = "lightgreen", high = "purple", na.value = "grey50", name = "RMM Tardia", limits = c(0, 50)) +
theme_minimal() +
theme(legend.position = "right")
})
# Salvando a base de dados 'obit_nasc' em um arquivo CSV
write.csv(obit_nasc, "~/UFES/OOBr/Morte Materna Tardia/MMT/Painel OOBr/painel-obitos-grav-puerp-main/obit_nasc.csv", row.names = FALSE)
